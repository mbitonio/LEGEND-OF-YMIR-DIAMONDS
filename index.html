<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LEGEND OF YMIR DIAMOND üíé</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --txt:#fff7fb; --mut:#ccb9c1; --mut2:#a8989f;
    --green:#21d072; --blue:#1877f2; --discord:#5865f2;
    --red1:#1a0f14; --red2:#120a10; --ink:#09060a;
    --border: rgba(255,100,140,.18);
    --glow-soft: 0 0 16px rgba(255,40,100,.22);
  }
  *{box-sizing:border-box}
  html,body{margin:0;color:var(--txt);font-family:Poppins,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--ink);min-height:100%}

  /* Background */
  body::before{
    content:"";position:fixed;inset:-20% -20%;z-index:-3;pointer-events:none;
    background:
      radial-gradient(40% 30% at 15% 10%, rgba(255,40,100,.14), transparent 60%),
      radial-gradient(38% 28% at 85% 5%, rgba(200,20,80,.10), transparent 65%),
      radial-gradient(55% 40% at 50% 110%, rgba(255,30,100,.10), transparent 72%);
    filter: blur(10px) saturate(112%);
    animation:bgFloat 18s ease-in-out infinite alternate;
  }
  @keyframes bgFloat{0%{transform:translate3d(0,0,0)}100%{transform:translate3d(1.2%,-1.2%,0)}}
  body::after{content:"";position:fixed;inset:0;z-index:-2;pointer-events:none;opacity:.45;
    background:
      radial-gradient(circle at 18% 28%, rgba(255,80,130,.25) 0 1px, transparent 2px),
      radial-gradient(circle at 78% 18%, rgba(255,60,110,.22) 0 1px, transparent 2px);
    animation:spark 11s linear infinite;
  }
  @keyframes spark{0%{transform:translateY(0)}100%{transform:translateY(-8px)}}

  .wrap{max-width:760px;margin:auto;padding:18px 16px 120px}
  /* Title: gray with subtle animated pink glow */
  .title{
    display:flex;gap:10px;justify-content:center;font-weight:800;font-size:22px;letter-spacing:.4px;margin:2px 0 8px;
    color:#bdbdbd;
    animation: titleGlow 2.2s ease-in-out infinite alternate;
  }
  @keyframes titleGlow{
    0%{ text-shadow:0 0 0 rgba(255,40,100,0); transform:translateY(0); }
    100%{ text-shadow:0 0 8px rgba(255,40,100,.18), 0 0 20px rgba(255,40,100,.12); transform:translateY(-1px); }
  }

  /* Logo: glowing ring only, animated */
  .logoWrap{display:grid;place-items:center;margin:8px 0}
  .logo{width:min(44vw,186px);aspect-ratio:1/1;border-radius:999px;position:relative;display:grid;place-items:center;background:transparent;cursor:pointer;overflow:visible}
  .ring{
    position:absolute;inset:6px;border-radius:999px;background:conic-gradient(from 0deg, rgba(255,40,120,0.12), rgba(255,80,140,0.06), rgba(255,40,120,0.12));
    filter: blur(12px); z-index:1; pointer-events:none;
    animation: ringSpin 12s linear infinite, ringPulse 2.6s ease-in-out infinite;
  }
  @keyframes ringSpin{to{transform:rotate(360deg)}}
  @keyframes ringPulse{
    0%{ box-shadow:0 0 24px rgba(255,40,120,.10), 0 0 60px rgba(255,40,120,.06); transform:scale(1); }
    50%{ box-shadow:0 0 44px rgba(255,40,120,.18), 0 0 90px rgba(255,40,120,.10); transform:scale(1.02); }
    100%{ box-shadow:0 0 24px rgba(255,40,120,.10), 0 0 60px rgba(255,40,120,.06); transform:scale(1); }
  }
  .logo img{width:82%;border-radius:999px;box-shadow:0 0 18px rgba(255,40,100,.18);position:relative;z-index:2;background:transparent}

  /* Owner */
  .owner{margin:10px auto 8px;display:flex;gap:10px;align-items:center;justify-content:center;padding:10px 12px;border-radius:14px;background:linear-gradient(180deg,#121116,#0b0b0f);border:1px solid rgba(255,255,255,.04);box-shadow:0 6px 16px rgba(0,0,0,.25);font-weight:800;max-width:560px}
  .owner a{color:#fff;text-decoration:none;display:inline-flex;align-items:center;gap:8px}
  .ownerName{letter-spacing:.3px}
  .metaBadge{width:22px;height:22px;display:inline-block;filter: drop-shadow(0 0 8px rgba(24,119,242,.35))}

  /* Tiers */
  .row{display:grid;gap:12px}
  .prices{display:grid;grid-template-columns:repeat(3,1fr);margin:6px 0 10px}
  .pill{position:relative;background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.00));border:1px solid rgba(255,100,140,.08);border-radius:18px;padding:12px;text-align:center;box-shadow:inset 0 0 0 1px rgba(255,30,80,.03), var(--glow-soft);transition:transform .18s, box-shadow .18s, border-color .18s, opacity .18s}
  .pval{font-size:26px;font-weight:900}
  .ptxt{font-size:12px;color:#ccb9c1}
  .pill.active{transform:translateY(-2px) scale(1.02);border-color:rgba(80,255,170,.12);box-shadow:0 0 12px rgba(40,255,170,.06)}
  .pill.lock{opacity:.55;filter:grayscale(.25);border-color:rgba(255,255,255,.06);box-shadow:none}
  .pill.flame{ box-shadow:0 0 14px rgba(255,90,40,.10) }

  /* Card / Inputs */
  .section{background:linear-gradient(180deg,#160f13,#0e0b10);border:1px solid var(--border);border-radius:18px;padding:14px;box-shadow:var(--glow-soft)}
  .label{font-size:13px;color:#ccb9c1;margin:4px 2px 6px}
  .in{width:100%;border:1px solid rgba(255,120,160,.12);background:#0b090c;color:var(--txt);padding:14px;border-radius:14px;font-size:18px;outline:none;box-shadow:inset 0 0 8px rgba(255,20,80,.03)}
  .in:focus{border-color:#ff6aa1;box-shadow:0 0 0 3px rgba(255,60,110,.08), var(--glow-soft)}
  .hint{font-size:12px;color:#a8989f;margin-top:6px}
  .warn{margin-top:8px;font-size:12px;color:#ff7b94;display:none}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px}
  .box{background:linear-gradient(180deg,#161016,#0f0c11);border:1px solid rgba(255,120,160,.06);border-radius:16px;padding:12px;text-align:center}
  .box h5{margin:0 0 4px;font-size:12px;color:#ccb9c1}
  .rateOut{font-weight:900;font-size:20px}
  .saveOut{font-weight:900;font-size:20px;color:#baffd6}
  .saveBox{background:linear-gradient(180deg,#07120b,#071012);border-color:rgba(40,255,160,.06)}

  /* Buttons */
  .btn{display:inline-flex;align-items:center;justify-content:center;gap:10px;border:none;border-radius:14px;padding:12px 14px;font-weight:800;letter-spacing:.2px;cursor:pointer;user-select:none}
  .buy{background:linear-gradient(180deg,#22d07a,#18b35f);color:#072012;font-size:16px;box-shadow:0 12px 28px rgba(24,200,110,.14);width:100%;margin-top:10px;transition:transform .12s}
  .buy:active{transform:translateY(1px)}
  .btn[disabled]{opacity:.55;filter:grayscale(.25);cursor:not-allowed}

  /* Suggestions list */
  .suggestions{position:relative}
  .suggestions-list{position:absolute;left:0;right:0;top:100%;background:#0b0a0d;border:1px solid rgba(255,255,255,.04);border-radius:10px;margin-top:8px;box-shadow:0 12px 36px rgba(0,0,0,.45);max-height:220px;overflow:auto;z-index:40}
  .suggest-item{padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.02);cursor:pointer}
  .suggest-item:last-child{border-bottom:none}
  .suggest-item:hover{background:rgba(255,255,255,.02)}

  /* Popups: glass + fade */
  .overlay{position:fixed;inset:0;display:none;place-items:center;z-index:120}
  .overlay.show{display:grid}
  .glass{
    width:min(92vw,520px);border-radius:14px;padding:18px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,0.06);
    box-shadow:0 12px 48px rgba(0,0,0,.6);transform:translateY(6px) scale(.98);opacity:0;transition:opacity .22s ease, transform .22s ease;
  }
  .overlay.show .glass{transform:translateY(0) scale(1);opacity:1}
  .popup-title{font-size:18px;margin:0 0 6px}
  .popup-body{color:#dcd3d8;font-size:14px}
  .popup-actions{margin-top:12px;display:flex;gap:10px;justify-content:center}

  /* confetti pulse */
  .confetti{
    width:72px;height:72px;border-radius:999px;background:radial-gradient(circle at 40% 30%, rgba(255,255,255,.95), rgba(255,255,255,.6) 20%, transparent 40%);
    box-shadow:0 8px 28px rgba(255,120,160,.08);margin:10px auto;transform:scale(.9);opacity:0;transition:opacity .28s, transform .28s;
  }
  .confetti.show{opacity:1;transform:scale(1.06);}

  @media (max-width:560px){ .grid2{grid-template-columns:1fr} }
</style>
</head>
<body>
  <div class="wrap">
    <div class="title">LEGEND OF YMIR DIAMOND üíé</div>

    <div class="logoWrap">
      <div class="logo" id="secretLogo" title="Secret: 6 taps marks delivered">
        <div class="ring" aria-hidden="true"></div>
        <img src="logo.png" alt="Logo">
      </div>
    </div>

    <div class="owner">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="#fff" aria-hidden="true"><path d="M22 12.07C22 6.48 17.52 2 11.93 2S2 6.48 2 12.07c0 5.01 3.66 9.17 8.44 9.93v-7.02H7.9v-2.91h2.54V9.41c0-2.5 1.49-3.89 3.77-3.89 1.09 0 2.24.2 2.24.2v2.46h-1.26c-1.24 0-1.63.77-1.63 1.56v1.87h2.78l-.44 2.91h-2.34V22c4.78-.76 8.44-4.92 8.44-9.93z"/></svg>
      <a href="https://www.facebook.com/share/1FWLHh32iE/" target="_blank" rel="noopener"><span class="ownerName">MOISES TRAJANO BITONIO</span>
      <svg class="metaBadge" viewBox="0 0 24 24" aria-hidden="true"><defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#2aa4ff"/><stop offset="1" stop-color="#1877f2"/></linearGradient></defs><circle cx="12" cy="12" r="10" fill="url(#g)"/><path d="M9.2 12.6l-1.7-1.7a1 1 0 10-1.4 1.4l2.4 2.4c.4.4 1 .4 1.4 0l6.1-6.1a1 1 0 10-1.4-1.4l-5.4 5.4z" fill="#fff"/></svg></a>
    </div>

    <!-- Tiers -->
    <div class="row prices">
      <div id="pill80" class="pill"><div class="pval">‚Ç±0.80</div><div class="ptxt">min 1000 üíé</div></div>
      <div id="pill75" class="pill"><div class="pval">‚Ç±0.75</div><div class="ptxt">min 4000 üíé</div></div>
      <div id="pill70" class="pill"><div class="pval">‚Ç±0.70</div><div class="ptxt">min 8000 üíé</div><div class="dealChip" aria-hidden="true">üî• BEST DEAL</div></div>
    </div>

    <!-- Inputs -->
    <div class="section">
      <div class="label">Enter Diamonds üíé</div>
      <input id="dias" class="in" inputmode="numeric" autocomplete="off" placeholder="e.g. 1500">

      <div class="label" style="margin-top:10px">ENTER PHP ‚Ç±</div>
      <input id="phpIn" class="in" inputmode="decimal" autocomplete="off" placeholder="e.g. 500.00">

      <div class="label" style="margin-top:10px">Server (Required)</div>
      <div class="suggestions">
        <input id="serverIn" class="in" placeholder="Type or search server (e.g., HOF1 / Asia022)" autocomplete="off" aria-autocomplete="list">
        <div id="suggestList" class="suggestions-list" style="display:none"></div>
      </div>

      <div class="hint">Piliin ang server mula sa list para maiwasan ang delay. (Auto-match exact names)</div>
      <div id="warn" class="warn">Minimum 1000 üíé required and Server is needed.</div>

      <div class="grid2">
        <div class="box"><h5>Rate</h5><div id="rateOut" class="rateOut">‚Äî</div></div>
        <div class="box saveBox"><h5>Save</h5><div id="saveOut" class="saveOut">‚Äî</div></div>
      </div>
    </div>

    <!-- BUY -->
    <button id="buyBtn" type="button" class="btn buy" disabled>‚úÖ COPY AND SEND TO SELLER</button>
    <div class="label" style="text-align:center;margin-top:8px">Enter at least 1000 dias, then choose your server from the suggestions.</div>

    <!-- Payment + Socials -->
    <div class="pay">
      <div id="gcashRow" class="gcashRow" title="Tap to copy number">
        <div class="gcashLeft"><div class="gcashIcon">G</div> GCash ‚Ä¢ <strong id="gcashNumber">09162466318 ‚Äî MOISES B.</strong></div>
        <button id="showQR" type="button" class="qrBtn" title="Show GCash QR">Show QR</button>
      </div>

      <div id="goRow" class="gcashRow" title="Tap to copy account" style="background:rgba(0,214,231,.06);border-color:rgba(0,214,231,.12)">
        <div class="gcashLeft"><svg width="26" height="26" viewBox="0 0 32 32" aria-hidden="true" style="border-radius:999px; box-shadow:0 0 8px rgba(0,214,231,.12)"><defs><linearGradient id="goTeal" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#00D6E7"/><stop offset="1" stop-color="#00BFD3"/></linearGradient></defs><rect x="0" y="0" width="32" height="32" rx="16" fill="url(#goTeal)"/><path d="M10.5 16a5.5 5.5 0 1 1 11 0 5.5 5.5 0 0 1-11 0zm2.6 0a2.9 2.9 0 1 0 5.8 0 2.9 2.9 0 0 0-5.8 0z" fill="#00353A" opacity=".95"/></svg> GoTyme ‚Ä¢ <strong id="goNumber">014664932955 ‚Äî MOISES BITONIO</strong></div>
        <button id="showGoQR" type="button" class="qrBtn" title="Show GoTyme QR">Show QR</button>
      </div>

      <div class="soc">
        <a class="btnlink fb" href="https://www.facebook.com/share/p/17MiaRJ24J/" target="_blank" rel="noopener">FACEBOOK FEEDBACK</a>
        <a class="btnlink dc" href="https://discord.gg/QkdVz5mh" target="_blank" rel="noopener">DISCORD FEEDBACK</a>
      </div>
    </div>

    <div class="notice">
      <h4>‚è≥ Waiting Time Notice</h4>
      <p>Processing time may vary depending on server demand. Some servers might experience longer wait times ‚Äî pero <strong>guaranteed matatanggap ang order mo</strong>.</p>
    </div>

    <!-- (Optional) Track Order kept ‚Äî local-only -->
    <div class="track" style="margin-top:14px">
      <div class="label" style="margin-bottom:6px">Track Order</div>
      <div style="display:grid;grid-template-columns:1fr auto;gap:10px">
        <input id="trackIn" class="in" placeholder="Enter Receipt ID (e.g., YMIR-XXXX)" autocomplete="off">
        <button id="trackBtn" class="btn" style="background:#27252c;color:#fff">Check</button>
      </div>
      <div id="trackOut" style="margin-top:10px;display:none">
        <div class="chip" style="margin-bottom:8px"><strong id="t_id">‚Äî</strong> <span id="t_status" style="opacity:.9"></span></div>
        <div style="display:grid;gap:6px;font-size:14px;color:#ccb9c1">
          <div>Server: <span id="t_server" style="color:#fff"></span></div>
          <div>Diamonds: <span id="t_qty" style="color:#fff"></span> üíé</div>
          <div>Rate: <span id="t_rate" style="color:#fff"></span></div>
          <div>Total: <span id="t_total" style="color:#fff"></span></div>
          <div>Created: <span id="t_time" style="color:#fff"></span></div>
        </div>
        <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
          <button id="btnPaid" class="btn" style="background:#204c2f;color:#e7fff1">Buyer: I Paid</button>
        </div>
        <div class="hint" style="margin-top:6px">Tip: Buyer taps <b>I Paid</b> after sending payment. (Local tracking only)</div>
      </div>
      <div id="trackNone" class="hint" style="display:none;margin-top:8px">Walang record sa device na ‚Äôto. Note: Tracking works on the same phone/browser (local only).</div>
    </div>

  </div>

  <!-- BUY Overlay -->
  <div id="buyOverlay" class="overlay" aria-hidden="true">
    <div class="glass" role="dialog" aria-modal="true" aria-labelledby="buyTitle">
      <h3 id="buyTitle" class="popup-title">Copied ‚úî</h3>
      <div class="popup-body">
        <p id="buyMsg"><strong>I-PASTE MO ITO SA MESSENGER KO.</strong></p>
        <div id="buyReceipt" style="margin-top:6px;font-weight:800"></div>
        <div id="thankConf" style="margin-top:10px;text-align:center">
          <div id="confetti" class="confetti" aria-hidden="true"></div>
          <div id="thankText" style="font-weight:700;margin-top:6px;color:#fbe9ef;display:none">üéâ Thank you for buying diamonds!</div>
        </div>
      </div>
      <div class="popup-actions">
        <button id="closeBuy" class="btn" style="background:#272327;color:#fff">OK</button>
      </div>
    </div>
  </div>

  <!-- GCash overlay -->
  <div id="gcashOverlay" class="overlay" aria-hidden="true">
    <div class="glass" role="dialog" aria-modal="true">
      <h3 class="popup-title">GCash Copied ‚úî</h3>
      <div class="popup-body"><p><strong>09162466318 ‚Äî MOISES B.</strong><br>Paste sa GCash Express Send.</p></div>
      <div class="popup-actions"><button id="gcashOk" class="btn" style="background:#272327;color:#fff">OK</button></div>
    </div>
  </div>

  <!-- QR overlays -->
  <div id="qrOverlay" class="overlay" aria-hidden="true">
    <div class="glass" role="dialog" aria-modal="true">
      <h3 class="popup-title">GCash QR</h3>
      <div class="popup-body"><p>Scan to pay ‚Ä¢ <strong>MOISES B.</strong></p><img src="gcash-qr.png" alt="GCash QR" class="qrImg" style="max-width:80%;display:block;margin:12px auto;border-radius:10px"></div>
      <div class="popup-actions"><button id="qrOk" class="btn" style="background:#272327;color:#fff">Close</button></div>
    </div>
  </div>

  <div id="goOverlay" class="overlay" aria-hidden="true">
    <div class="glass" role="dialog" aria-modal="true">
      <h3 class="popup-title">GoTyme Copied ‚úî</h3>
      <div class="popup-body"><p><strong>014664932955 ‚Äî MOISES BITONIO</strong><br>Paste sa GoTyme Send Money.</p></div>
      <div class="popup-actions"><button id="goOk" class="btn" style="background:#272327;color:#fff">OK</button></div>
    </div>
  </div>

  <div id="goQROverlay" class="overlay" aria-hidden="true">
    <div class="glass" role="dialog" aria-modal="true">
      <h3 class="popup-title">GoTyme QR</h3>
      <div class="popup-body"><p>Scan to pay ‚Ä¢ <strong>MOISES BITONIO</strong></p><img src="gotyme-qr.png" alt="GoTyme QR" class="qrImg" style="max-width:80%;display:block;margin:12px auto;border-radius:10px"></div>
      <div class="popup-actions"><button id="goQROk" class="btn" style="background:#272327;color:#fff">Close</button></div>
    </div>
  </div>

<script>
(function(){
  const $ = id => document.getElementById(id);
  const clean = v => String(v ?? '').replace(/[^\d.]/g,'');
  const toInt = v => { const m = clean(v).match(/^\d+/); return m? parseInt(m[0],10):0; };
  const toNum = v => { const m = clean(v).match(/^\d+(?:\.\d+)?/); return m? parseFloat(m[0]):0; };
  const fmt = n => Number(n).toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2});

  const MIN1=1000, MIN2=4000, MIN3=8000;
  const T1=0.80, T2=0.75, T3=0.70;

  // server list from user
  const servers = [
"Á†¥ÂÜõ","8888","DaddyKim","DaddyVerse","DaddyWorld","HOF1","HOF2","HOF3","HOF4","HOF5","HOF6","HERO","KINGS","Kings2","Kings3","Kings4","xaou","Chess","ISEKAI","ManiTW","PROSGARD","X","MEGA","Sky","Tokyo","Bangkok","Taipei","Asia014","Asia015","Asia016","Asia017","Asia018","Asia019","Asia020","Asia021","Asia022","Asia023","Asia024","Asia025","Asia026","Asia027","Asia028","Asia029","Asia030","Asia031","Asia032","Asia033","Asia034","Asia035","Asia036","Asia037","Asia038","Asia039","Asia040","Asia041","Asia042","Asia043"
  ];

  const STORE_KEY='ymir_orders';
  const loadOrders = () => { try{ return JSON.parse(localStorage.getItem(STORE_KEY)||'{}'); }catch{return{}} };
  const saveOrders = m => { try{ localStorage.setItem(STORE_KEY, JSON.stringify(m)); }catch{} };

  function getRate(q){
    if(!q || q<MIN1) return null;
    if(q<MIN2) return T1;
    if(q<MIN3) return T2;
    return T3;
  }
  function estimateFromPHP(p){
    if(!p||p<=0) return 0;
    let q = Math.floor(p/T1);
    for(let i=0;i<4;i++){
      const r = getRate(q) ?? T1;
      q = Math.floor(p/r);
    }
    return q;
  }

  function paintPills(q, r){
    const p80=$('pill80'), p75=$('pill75'), p70=$('pill70');
    [p80,p75,p70].forEach(p=>p.classList.remove('active','lock','flame','best'));
    if(!q || q<MIN1){ p80.classList.add('lock'); p75.classList.add('lock'); p70.classList.add('lock'); return; }
    if(q<MIN2) p75.classList.add('lock');
    if(q<MIN3) p70.classList.add('lock');
    if(r===T1) p80.classList.add('active');
    if(r===T2) p75.classList.add('active');
    if(r===T3){ p70.classList.add('active','flame','best'); }
  }

  const diasEl=$('dias'), phpEl=$('phpIn'), serverEl=$('serverIn');
  const rateOut=$('rateOut'), saveOut=$('saveOut'), warn=$('warn'), buyBtn=$('buyBtn');
  const suggestList = $('suggestList');
  let lastEdited=null;

  const validServer = () => servers.includes(serverEl.value.trim());

  function recalc(){
    let q = toInt(diasEl.value);
    let p = toNum(phpEl.value);

    if(lastEdited==='p'){ q = estimateFromPHP(p); diasEl.value = q?String(q):''; }
    else if(lastEdited==='d'){ const r=getRate(q); phpEl.value = (r&&q)? fmt(q*r):''; }
    else{
      if(!q && p){ q = estimateFromPHP(p); diasEl.value = q?String(q):''; }
      if(q && !p){ const r=getRate(q); phpEl.value = r? fmt(q*r):''; }
    }

    const r=getRate(q);
    paintPills(q,r);

    const ok = q>=MIN1 && !!r && validServer();
    warn.style.display = ok ? 'none' : 'block';
    buyBtn.disabled = !ok;

    if(r && q){
      rateOut.textContent = `‚Ç±${r.toFixed(2)} / dia`;
      const base=q*T1, saveAmt=Math.max(0, base-(q*r));
      const savePct=Math.max(0,(1-r/T1)*100);
      saveOut.textContent = `${savePct.toFixed(2)}% ‚Ä¢ ‚Ç±${fmt(saveAmt)}`;
    }else{
      rateOut.textContent='‚Äî';
      saveOut.textContent='‚Äî';
    }
  }

  ['input','change','keyup'].forEach(ev=>{
    diasEl.addEventListener(ev, ()=>{ lastEdited='d'; recalc(); });
    phpEl.addEventListener(ev,  ()=>{ lastEdited='p'; recalc(); });
    serverEl.addEventListener('input', ()=>{ filterServers(serverEl.value); recalc(); });
  });
  recalc();

  /* Server suggestion helpers */
  function filterServers(q){
    const v = String(q||'').trim();
    if(!v){ suggestList.style.display='none'; suggestList.innerHTML=''; return; }
    const qlow = v.toLowerCase();
    const starts = servers.filter(s=>s.toLowerCase().startsWith(qlow));
    const includes = servers.filter(s=>!s.toLowerCase().startsWith(qlow) && s.toLowerCase().includes(qlow));
    const matches = starts.concat(includes).slice(0,80);
    if(matches.length===0){ suggestList.style.display='none'; suggestList.innerHTML=''; return; }
    suggestList.innerHTML = matches.map(s=>`<div class="suggest-item" data-val="${escapeHtml(s)}">${escapeHtml(s)}</div>`).join('');
    suggestList.style.display='block';
    Array.from(suggestList.children).forEach(ch=>{
      ch.addEventListener('click', ()=>{
        serverEl.value = ch.getAttribute('data-val');
        suggestList.style.display='none';
        recalc();
      });
    });
  }
  function escapeHtml(t){ return String(t).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
  document.addEventListener('click', (e)=>{ if(!e.target.closest('.suggestions')){ suggestList.style.display='none'; } });

  /* Receipt helpers */
  function genRID(){
    const t = Date.now().toString(36).toUpperCase();
    const r = Math.random().toString(36).slice(2,6).toUpperCase();
    return `YMIR-${t}-${r}`;
  }

  function setStatusUI(status){
    const s=$('t_status');
    s.textContent = status;
    s.style.color = status==='DELIVERED' ? '#ff8aa0' : status==='PAID' ? '#22cf74' : '#ffd64d';
  }

  /* Overlays */
  function showOverlay(el){ el.classList.add('show'); el.style.display='grid'; el.setAttribute('aria-hidden','false'); }
  function hideOverlay(el){ el.classList.remove('show'); el.setAttribute('aria-hidden','true'); setTimeout(()=>el.style.display='none',260); }

  /* BUY button */
  $('buyBtn').addEventListener('click', async ()=>{
    let q = toInt(diasEl.value);
    let p = toNum(phpEl.value);
    if(!q && p) q = estimateFromPHP(p);
    const r = getRate(q);
    if(!r || !validServer()){ recalc(); return; }
    const total = p || (q*r);
    const rid = genRID();

    const msg = `BUY ORDER
Diamonds: ${q} üíé
Server: ${serverEl.value.trim()}
Rate: ‚Ç±${r.toFixed(2)} / dia
Total: ‚Ç±${fmt(total)}
GCash: 09162466318 (MOISES B.)
Receipt ID: ${rid}`;

    try{ await navigator.clipboard.writeText(msg); }catch(e){ /* ignore */ }

    // save locally
    const map = loadOrders();
    map[rid] = {status:'PENDING', server: serverEl.value.trim(), qty:q, rate:r, total, time:new Date().toISOString()};
    saveOrders(map);

    // show overlay + thank you pulse
    $('buyReceipt').textContent = `Receipt ID: ${rid}`;
    $('buyMsg').innerHTML = `<strong>I-PASTE MO ITO SA MESSENGER KO.</strong><br><small style="opacity:.95">${msg.replace(/\n/g,'<br>')}</small>`;
    const overlay = $('buyOverlay'); showOverlay(overlay);

    const conf = $('confetti'), thanks = $('thankText');
    conf.classList.add('show'); thanks.style.display='block';
    setTimeout(()=>{ conf.classList.remove('show'); }, 2200);
    setTimeout(()=>{ hideOverlay(overlay); thanks.style.display='none'; }, 5200);

    // prefill track
    $('trackIn').value = rid;
    showTrack(rid, map[rid]);
  });

  $('closeBuy').addEventListener('click', ()=>{ hideOverlay($('buyOverlay')); $('thankText').style.display='none'; });

  /* Track UI */
  function showTrack(id, rec){
    if(rec){
      $('trackOut').style.display='block';
      $('trackNone').style.display='none';
      $('t_id').textContent = id;
      setStatusUI(rec.status);
      $('t_server').textContent = rec.server || '‚Äî';
      $('t_qty').textContent = rec.qty || '‚Äî';
      $('t_rate').textContent = rec.rate ? `‚Ç±${rec.rate.toFixed(2)} / dia` : '‚Äî';
      $('t_total').textContent = rec.total ? `‚Ç±${fmt(rec.total)}` : '‚Äî';
      $('t_time').textContent = rec.time ? new Date(rec.time).toLocaleString() : '‚Äî';
    }else{
      $('trackOut').style.display='none';
      $('trackNone').style.display='block';
    }
  }
  (function(){
    const params = new URLSearchParams(location.search);
    const rid = params.get('rid');
    if(rid){
      $('trackIn').value = rid;
      const rec = loadOrders()[rid];
      showTrack(rid, rec);
    }
  })();
  $('trackBtn').addEventListener('click', ()=>{ const id = $('trackIn').value.trim(); const rec = loadOrders()[id]; showTrack(id, rec); });
  $('btnPaid').addEventListener('click', ()=>{ const id = $('trackIn').value.trim(); const map=loadOrders(); if(!map[id]) return; map[id].status='PAID'; saveOrders(map); setStatusUI('PAID'); });

  // secret delivered: 6 taps on logo
  let tapCount=0, tapTimer=null;
  $('secretLogo').addEventListener('click', ()=>{
    tapCount++; clearTimeout(tapTimer);
    tapTimer=setTimeout(()=>tapCount=0,900);
    if(tapCount>=6){
      tapCount=0;
      const map = loadOrders();
      const ids = Object.keys(map).reverse();
      const latest = ids.find(id=>map[id] && map[id].status === 'PENDING');
      if(latest){ map[latest].status='DELIVERED'; saveOrders(map); }
    }
  });

  /* GCash copy + overlay */
  (function(){
    const row=$('gcashRow'), pop=$('gcashOverlay'), ok=$('gcashOk');
    row.addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText('09162466318'); }catch(e){}; showOverlay(pop); });
    ok.addEventListener('click', ()=> hideOverlay(pop));
  })();

  /* GCash QR */
  (function(){ const btn=$('showQR'), pop=$('qrOverlay'), ok=$('qrOk'); btn.addEventListener('click', ()=> showOverlay(pop)); ok.addEventListener('click', ()=> hideOverlay(pop)); })();

  /* GoTyme copy + overlay */
  (function(){ const row=$('goRow'), pop=$('goOverlay'), ok=$('goOk'); row.addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText('014664932955'); }catch(e){}; showOverlay(pop); }); ok.addEventListener('click', ()=> hideOverlay(pop)); })();

  /* GoTyme QR */
  (function(){ const btn=$('showGoQR'), pop=$('goQROverlay'), ok=$('goQROk'); btn && btn.addEventListener('click', ()=> showOverlay(pop)); ok && ok.addEventListener('click', ()=> hideOverlay(pop)); })();

  // small error toast
  window.addEventListener('error', function (e) {
    try{
      const t = document.createElement('div'); t.textContent = 'Error: ' + (e.message || 'unknown');
      Object.assign(t.style, {position:'fixed', left:'8px', bottom:'8px', background:'rgba(255,0,80,.12)', color:'#fff', padding:'8px 10px', border:'1px solid rgba(255,0,80,.35)', borderRadius:'8px', zIndex:99999, fontSize:'12px', maxWidth:'90vw'});
      document.body.appendChild(t); setTimeout(()=>t.remove(), 5000);
    }catch(_){}
  });

})(); // IIFE
</script>
</body>
</html>
